# For on_actions launched by the code itself.

# Root = Country
on_yearly_pulse_country = {
	on_actions = {
		bem_on_yearly_events
	}
}

bem_on_yearly_events = {
	effect = {
		trigger_event = { # Colonial / Imperial Conference
			id = bem.10
			days = { 60 240 }
		}
		trigger_event = { # Colonial / Imperial Conference (hidden) --> Still fires but player doesn't get an event
			id = bem.11
			days = { 60 240 }
		}
		trigger_event = { # Colonial / Imperial Conference (hidden) --> Still fires but player doesn't get an event
			id = bem.100
			days = { 1 360 }
		}
		trigger_event = { # Colonial / Imperial Conference (hidden) --> Still fires but player doesn't get an event
			id = bem.101
			days = { 1 360 }
		}
	}
}

# Root = Releasing Country
# scope:target = Released Country
on_country_released_as_own_subject = {
	on_actions = {
		bem_on_country_released_as_own_subject
	}
}

bem_on_country_released_as_own_subject = {
	effect = {
		if = {
			limit = {
				exists = c:GBR
				root = c:GBR
			}
			scope:target = {
				trigger_event = {
					id = bem.1
				}
			}
		}
		else_if = {
			limit = {
				scope:target = {
					OR = {
						is_country_type = colonial
						is_country_type = unrecognized
						AND = {
							exists = c:CYP
							root = c:CYP
						}
						AND = {
							exists = c:MLT
							root = c:MLT
						}
						AND = {
							exists = c:CRE
							root = c:CRE
						}
						AND = {
							exists = c:ION
							root = c:ION
						}
					}
				}
			}

			scope:target = {
				# Makes the Colony a puppet
				change_subject_type = subject_type_puppet

				#Changes government type to presidial
				activate_law = law_type:law_presidential_republic
			}

			# Switches the Religion to the Religion of the Releasing Country
			if = {
				limit = {
					ROOT = {
						NOT = {
							religion = rel:protestant
						}
					}
				}
				scope:target = {
					set_state_religion = root.religion
				}
			}

			#Switches the primary Culture to the primary Culture of the Releasing Country
			if = {
				limit = {
					ROOT = {
						NOT = {
							country_has_primary_culture = cu:british
						}
					}
				}
				ordered_primary_culture = {
					save_scope_as = switch_primary_culture_to_scope
				}
				scope:target = {
					add_primary_culture = scope:switch_primary_culture_to_scope
					while = {
						limit = {
							any_primary_culture = {
								NOT = {
									this = scope:switch_primary_culture_to_scope
								}
							}
						}
						random_primary_culture = {
							limit = { 
								NOR = {
									this = scope:switch_primary_culture_to_scope
									cu:boer
								}
							}
							save_scope_as = primary_culture_delete_scope
						}
						remove_primary_culture = scope:primary_culture_delete_scope
					}
				}
			}
		}
	}
}