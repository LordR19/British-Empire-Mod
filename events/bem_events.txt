namespace = bem

# Event to set up Governors i n the appropriate countries
bem.1 = {
	type = country_event
	hidden = yes

	trigger = {
		OR = {
			is_country_type = colonial
			is_country_type = unrecognized
			AND = {
				exists = c:CYP
				root = c:CYP
			}
			AND = {
				exists = c:MLT
				root = c:MLT
			}
			AND = {
				exists = c:CRE
				root = c:CRE
			}
			AND = {
				exists = c:ION
				root = c:ION
			}
		}
	}

	immediate = {
#			add_primary_culture = cu:british
#			set_state_religion = rel:protestant
#			while = {
#				limit = {
#					any_primary_culture = {
#						NOT = {
#							this = cu:british
#						}
#					}
#				}
#				random_primary_culture = {
#					limit = { 
#						NOT = {
#							this = cu:british
#						}
#					}
#					save_scope_as = primary_culture_delete_scope
#				}
#				remove_primary_culture = scope:primary_culture_delete_scope
#			} 
#		}

		activate_law = law_type:law_presidential_republic
		trigger_event = {
			id = bem.2
			days = 1
		}

		if = {
			limit = {
				OR = {
					AND = {
						exists = c:CAN
						root = c:CAN
					}
					AND = {
						exists = c:AST
						root = c:AST
					}
					AND = {
						exists = c:NZL
						root = c:NZL
					}
					AND = {
						exists = c:SAF
						root = c:SAF
					}
				}
				NOT = {
					is_subject_type = subject_type_dominion
				}
			}
			
			change_subject_type = subject_type_dominion
		}

		if = {
			limit = {
				OR = {
					AND = {
						exists = c:HGK
						root = c:HGK
					}
					AND = {
						exists = c:NAL
						root = c:NAL
					}
					AND = {
						exists = c:SST
						root = c:SST
					}
					AND = {
						exists = c:C1E
						root = c:C1E
					}
					AND = {
						exists = c:C1C
						root = c:C1C
					}
					AND = {
						exists = c:C1P
						root = c:C1P
					}
					AND = {
						exists = c:C1I
						root = c:C1I
					}
					AND = {
						exists = c:C1A
						root = c:C1A
					}
					AND = {
						exists = c:C1Y
						root = c:C1Y
					}
					AND = {
						exists = c:C1S
						root = c:C1S
					}
					AND = {
						exists = c:C1N
						root = c:C1N
					}
					AND = {
						exists = c:C1K
						root = c:C1K
					}
					AND = {
						exists = c:C1T
						root = c:C1T
					}
					AND = {
						exists = c:C2T
						root = c:C2T
					}
					AND = {
						exists = c:C1U
						root = c:C1U
					}
					AND = {
						exists = c:C2S
						root = c:C2S
					}
					AND = {
						exists = c:C2C
						root = c:C2C
					}
					AND = {
						exists = c:C1W
						root = c:C1W
					}
					AND = {
						exists = c:C1B
						root = c:C1B
					}
					AND = {
						exists = c:C1R
						root = c:C1R
					}
					AND = {
						exists = c:C2R
						root = c:C2R
					}
				}
			}
			change_subject_type = subject_type_puppet
		}
	}
}

#Event used to create a new governor that is male and british
bem.2 = {
	type = country_event
	hidden = yes

	trigger = {
	}

	immediate = {
		create_character = {
			ruler = yes
			culture = cu:british
			female = no
		}
	}
}

# Colonial / Imperial Conference
bem.10 = {
	type = country_event
	placement = ROOT

	title = bem.10.t
	desc = bem.10.d
	flavor = bem.10.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_signed_contract.bk2"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/unspecific/signed_contract"

	icon = "gfx/interface/icons/event_icons/event_trade.dds"

	cooldown = {
		years = 4
	}

	trigger = {
		NOT = {
			has_variable = bem_no_more_imperial_conference_var
		}
		year >= 1887
		exists = c:GBR
		this = c:GBR
		any_country = {
			is_direct_subject_of = c:GBR
			NOT = {
				this = c:GBR
			}
			count > 3
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_direct_subject_of = c:GBR
			}
			save_scope_as = bem_happy_subject_scope_1
			set_variable = bem_happy_subject_block_var
		}
		random_country = {
			limit = {
				NOT = {
					has_variable = bem_happy_subject_block_var
				}
				is_direct_subject_of = c:GBR
			}
			save_scope_as = bem_happy_subject_scope_2
			set_variable = bem_happy_subject_block_var
		}
		random_country = {
			limit = {
				NOT = {
					has_variable = bem_happy_subject_block_var
				}
				is_direct_subject_of = c:GBR
			}
			save_scope_as = bem_subject_with_request_scope
		}
		set_global_variable = {
			name = bem_subject_request_global_var
			value = scope:bem_subject_with_request_scope
			days = 120
		}
		
		set_variable = {
			name = bem_request_var
			value = { 1 4 }
		}
		round_variable = {
			name = bem_request_var
			nearest = 1
		}
	}

	option = { #Support Scope!
		name = bem.10.a
		default_option = yes

		change_relations = {
			country = scope:bem_happy_subject_scope_1
			value = 20
		}
		change_relations = {
			country = scope:bem_happy_subject_scope_2
			value = 20
		}
		if = {
			limit = {
				var:bem_request_var = 1
			}
			add_treasury = -1000000
			scope:bem_subject_with_request_scope = {
				add_treasury = 1000000
			}
			change_relations = {
				country = scope:bem_subject_with_request_scope
				value = 20
			}
		}
		if = {
			limit = {
				var:bem_request_var = 2
			}
			add_treasury = -1000000
			scope:bem_subject_with_request_scope = {
				add_investment_pool  = 1000000
			}
			change_relations = {
				country = scope:bem_subject_with_request_scope
				value = 20
			}
		}
		if = {
			limit = {
				var:bem_request_var = 3
			}
			add_modifier = {
				name = bem_bureaucratic_support_sent_modifier
				months = 12
			}
			scope:bem_subject_with_request_scope = {
				add_modifier = {
					name = bem_bureaucratic_support_modifier
					months = 12
				}
			}
			change_relations = {
				country = scope:bem_subject_with_request_scope
				value = 20
			}
		}
		if = {
			limit = {
				var:bem_request_var = 4
			}
			add_modifier = {
				name = bem_construction_support_sent_modifier
				months = 12
			}
			scope:bem_subject_with_request_scope = {
				add_modifier = {
					name = bem_construction_support_modifier
					months = 12
				}
			}
			change_relations = {
				country = scope:bem_subject_with_request_scope
				value = 20
			}
		}
		every_country = {
			limit = {
				has_variable = bem_happy_subject_block_var
			}
			remove_variable = bem_happy_subject_block_var
		}
	}

	option = { #We don't have the means to support Scope.
		name = bem.10.b
		default_option = yes

		change_relations = {
			country = scope:bem_happy_subject_scope_1
			value = 20
		}
		change_relations = {
			country = scope:bem_happy_subject_scope_2
			value = 20
		}
		change_relations = {
			country = scope:bem_subject_with_request_scope
			value = -20
		}
		every_country = {
			limit = {
				has_variable = bem_happy_subject_block_var
			}
			remove_variable = bem_happy_subject_block_var
		}
	}

	option = { #I don't care. I don't want to hear about it!
		name = bem.10.c

		change_relations = {
			country = scope:bem_happy_subject_scope_1
			value = 20
		}
		change_relations = {
			country = scope:bem_happy_subject_scope_2
			value = 20
		}
		every_country = {
			limit = {
				has_variable = bem_happy_subject_block_var
			}
			remove_variable = bem_happy_subject_block_var
		}

		custom_tooltip = bem_10.c.tt

		set_variable = bem_no_more_imperial_conference_var
	}
}

# Colonial / Imperial Conference (hidden)
bem.11 = {
	type = country_event
	hidden = yes

	trigger = {
		has_variable = bem_no_more_imperial_conference_var
		year >= 1887
		exists = c:GBR
		this = c:GBR
		any_country = {
			is_direct_subject_of = c:GBR
			NOT = {
				this = c:GBR
			}
			count > 2
		}
	}

	cooldown = {
		years = 4
	}

	immediate = {
		random_country = {
			limit = {
				is_direct_subject_of = c:GBR
			}
			save_scope_as = bem_happy_subject_scope_1
			set_variable = bem_happy_subject_block_var
		}
		random_country = {
			limit = {
				NOT = {
					has_variable = bem_happy_subject_block_var
				}
				is_direct_subject_of = c:GBR
			}
			save_scope_as = bem_happy_subject_scope_2
			set_variable = bem_happy_subject_block_var
		}

		change_relations = {
			country = scope:bem_happy_subject_scope_1
			value = 20
		}
		change_relations = {
			country = scope:bem_happy_subject_scope_2
			value = 20
		}
		every_country = {
			limit = {
				has_variable = bem_happy_subject_block_var
			}
			remove_variable = bem_happy_subject_block_var
		}
	}
}

# Sherlock Holmes published
bem.100 = {
	type = country_event
	placement = ROOT

	title = bem.100.t
	desc = bem.100.d
	flavor = bem.100.f

	duration = 3

	gui_window = event_window_1char_tabloid

	left_icon = scope:bem_doyle_scope

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/unspecific/world_fair"

	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	cooldown = {
		years = 4
	}

	trigger = {
		NOT = {
			has_global_variable = bem_sherlock_holmes_global_var
		}
		year >= 1887
		exists = c:GBR
		this = c:GBR
	}

	immediate = {
		set_global_variable = bem_sherlock_holmes_global_var

		create_character = {
			dna = bem_doyle
			first_name = bem_arthur_conan
			last_name = bem_doyle
	#		birth_date = 1859.5.22
			culture = cu:scottish
			interest_group = ig_petty_bourgeoisie
			female = no
			traits = { 
				innovative
				romantic
			}

			save_scope_as = bem_doyle_scope

			on_created = {
				scope:bem_doyle_scope = {
					place_character_in_void = 4
				}
			}
		}
	}

	option = { #Support Scope!
		name = bem.100.a
		default_option = yes

		add_modifier = {
			name = bem_sherlock_holmes_modifier
		}
	}
}